!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-btn",inactiveButtonClass:"modal__save-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const n=e.querySelector(`#${t.id}-error`);n.textContent="",n.classList.remove(r.errorClass),t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},n=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},o=(e,r,n)=>{r.forEach(r=>{t(e,r,n)})};const a=document.querySelector(".profile__avatar-btn"),s=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__name"),c=document.querySelector(".profile__description"),i=document.querySelector(".profile__edit-btn"),d=document.querySelector(".profile__new-btn"),u=document.querySelector("#edit-avatar-modal"),m=u.querySelector(".modal__close-btn"),_=u.querySelector(".modal__form"),v=u.querySelector("#profile-avatar-input"),f=u.querySelector(".modal__save-btn"),p=document.querySelector("#edit-profile-modal"),h=p.querySelector(".modal__close-btn"),S=p.querySelector(".modal__form"),y=p.querySelector("#profile-name-input"),q=p.querySelector("#profile-description-input"),b=document.querySelector("#new-post-modal"),E=b.querySelector(".modal__close-btn"),L=b.querySelector(".modal__form"),C=b.querySelector("#image-link-input"),k=b.querySelector("#caption-input"),g=b.querySelector(".modal__save-btn"),U=document.querySelector("#preview-modal"),x=U.querySelector(".modal__close-btn"),A=U.querySelector(".modal__image"),I=U.querySelector(".modal__caption"),w=document.querySelector("#card-template").content.querySelector(".card"),$=document.querySelector(".cards__list"),B=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_handleServerResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>this._handleServerResponse(e))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>this._handleServerResponse(e))}editAvatarInfo({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(e=>this._handleServerResponse(e))}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>this._handleServerResponse(e))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"c2f31a89-a6b4-4dfc-9981-f2de219cf61f","Content-Type":"application/json"}});function R(e){const t=w.cloneNode(!0),r=t.querySelector(".card__title"),n=t.querySelector(".card__image");n.src=e.link,n.alt=e.name,r.textContent=e.name;const o=t.querySelector(".card__like-btn");return o.addEventListener("click",()=>{o.classList.toggle("card__like-btn_active")}),t.querySelector(".card__delete-btn").addEventListener("click",()=>{t.remove()}),n.addEventListener("click",()=>{A.src=e.link,A.alt=e.name,I.textContent=e.name,P(U)}),t}function P(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",D)}function j(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",D)}function D(e){if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&j(e)}}B.getAppInfo().then(([e,t])=>{l.textContent=t.name,c.textContent=t.about,s.src=t.avatar,s.alt=t.name,e.forEach(e=>{$.append(R(e))})}).catch(console.error),a.addEventListener("click",function(){o(_,[v],e),P(u)}),m.addEventListener("click",function(){j(u)}),_.addEventListener("submit",function(t){t.preventDefault(),B.editAvatarInfo({avatar:v.value}).then(t=>{s.src=t.avatar,_.reset(),j(u),n(f,e)}).catch(console.error)}),x.addEventListener("click",function(){j(U)}),i.addEventListener("click",function(){y.value=l.textContent,q.value=c.textContent,o(S,[y,q],e),P(p)}),h.addEventListener("click",function(){j(p)}),S.addEventListener("submit",function(e){e.preventDefault(),B.editUserInfo({name:y.value,about:q.value}).then(e=>{l.textContent=e.name,c.textContent=e.about,j(p)}).catch(console.error)}),d.addEventListener("click",function(){P(b)}),E.addEventListener("click",function(){j(b)}),L.addEventListener("submit",function(t){t.preventDefault();const r=R({name:k.value,link:C.value});$.prepend(r),L.reset(),j(b),n(g,e)}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("mousedown",t=>{t.target===e&&j(e)})}),(e=>{document.querySelectorAll(e.formSelector).forEach(n=>{((e,n)=>{const o=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);r(o,a,n),o.forEach(s=>{s.addEventListener("input",function(){((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{const o=e.querySelector(`#${t.id}-error`);o.textContent=r,o.classList.add(n.errorClass),t.classList.add(n.inputErrorClass)})(e,r,r.validationMessage,n)})(e,s,n),r(o,a,n)})})})(n,e)})})(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxLQUN0QnJILEVBQVlpSCxpQkFBaUJ6SCxFQUFPRSxnQkFFaENnQixFQUFnQlYsRUFBWUcsY0FBY1gsRUFBT0csc0JBRXZEYSxFQUFrQkMsRUFBV0MsRUFBZWxCLEdBRTVDaUIsRUFBVVcsUUFBU25CLElBQ2pCQSxFQUFhMkYsaUJBQWlCLFFBQVMsV0EvQ2hCMEIsRUFBQ3RILEVBQWFDLEVBQWNULEtBQ2hEUyxFQUFhVyxTQUFTQyxNQVF6QmQsRUFBZUMsRUFBYUMsRUFBY1QsR0F2QnZCK0gsRUFBQ3ZILEVBQWFDLEVBQWN1SCxFQUFjaEksS0FDL0QsTUFBTVUsRUFBZUYsRUFBWUcsY0FBYyxJQUFJRixFQUFhRyxZQUNoRUYsRUFBYUcsWUFBY21ILEVBQzNCdEgsRUFBYUksVUFBVVcsSUFBSXpCLEVBQU9NLFlBQ2xDRyxFQUFhSyxVQUFVVyxJQUFJekIsRUFBT0ssa0JBWWhDMEgsQ0FDRXZILEVBQ0FDLEVBQ0FBLEVBQWF3SCxrQkFDYmpJLElBMENBOEgsQ0FBbUJ0SCxFQUFhQyxFQUFjVCxHQUM5Q2dCLEVBQWtCQyxFQUFXQyxFQUFlbEIsRUFDOUMsTUFPQTJILENBQWtCaEcsRUFBUTNCLE1Dc0o5QmtJLENBQWlCbEksRSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zYXZlLWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zYXZlLWJ0bl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5lcnJvckNsYXNzKTtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuZXJyb3JDbGFzcyk7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKFxuICAgICAgZm9ybUVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQsXG4gICAgICBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsXG4gICAgICBjb25maWdcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcbiAgfSk7XG59O1xuXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gIH1cbn07XG5leHBvcnQgY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcbiAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG59O1xuXG5leHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcilcbiAgKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn07XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgY29uZmlnLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuXG4vLyBET00gRUxFTUVOVCBSRUZFUkVOQ0VTXG5cbi8vIFByb2ZpbGUgZWxlbWVudHNcbmNvbnN0IGVkaXRBdmF0YXJCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XG5jb25zdCBwcm9maWxlQXZhdGFyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25FbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5jb25zdCBlZGl0UHJvZmlsZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XG5jb25zdCBuZXdQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uZXctYnRuXCIpO1xuXG4vLyBFZGl0IGF2YXRhciBtb2RhbCBlbGVtZW50c1xuY29uc3QgZWRpdEF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGVkaXRBdmF0YXJDbG9zZUJ0biA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBlZGl0QXZhdGFyRm9ybUVsID0gZWRpdEF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBlZGl0QXZhdGFySW5wdXQgPSBlZGl0QXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWF2YXRhci1pbnB1dFwiKTtcbmNvbnN0IGVkaXRBdmF0YXJTdWJtaXRCdG4gPSBlZGl0QXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idG5cIik7XG5cbi8vIEVkaXQgcHJvZmlsZSBtb2RhbCBlbGVtZW50c1xuY29uc3QgZWRpdFByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVDbG9zZUJ0biA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVGb3JtRWwgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBlZGl0UHJvZmlsZU5hbWVJbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1uYW1lLWlucHV0XCJcbik7XG5jb25zdCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcblxuLy8gTmV3IHBvc3QgbW9kYWwgZWxlbWVudHNcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBuZXdQb3N0Q2xvc2VCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgbmV3UG9zdEZvcm1FbCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgbmV3UG9zdExpbmtJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2ltYWdlLWxpbmstaW5wdXRcIik7XG5jb25zdCBuZXdQb3N0Q2FwdGlvbklucHV0ID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FwdGlvbi1pbnB1dFwiKTtcbmNvbnN0IG5ld1Bvc3RTdWJtaXRCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idG5cIik7XG5cbi8vIFByZXZpZXcgbW9kYWwgZWxlbWVudHNcbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IHByZXZpZXdJbWFnZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld0NhcHRpb25FbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBDYXJkcyBlbGVtZW50c1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnRcbiAgLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKVxuICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIik7XG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuXG4vLyBBUEkgSU5TVEFOQ0VcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiYzJmMzFhODktYTZiNC00ZGZjLTk5ODEtZjJkZTIxOWNmNjFmXCIsIC8vIFJlcGxhY2Ugd2l0aCB5b3VyIGFjdHVhbCB0b2tlblxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbi8vIElOSVRJQUwgREFUQSBMT0FEXG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHVzZXJdKSA9PiB7XG4gICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcbiAgICBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudCA9IHVzZXIuYWJvdXQ7XG4gICAgcHJvZmlsZUF2YXRhckVsLnNyYyA9IHVzZXIuYXZhdGFyO1xuICAgIHByb2ZpbGVBdmF0YXJFbC5hbHQgPSB1c2VyLm5hbWU7XG5cbiAgICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgICBjYXJkc0xpc3QuYXBwZW5kKGdldENhcmRFbGVtZW50KGNhcmQpKTtcbiAgICB9KTtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG4vLyBGVU5DVElPTlMgJiBIQU5ETEVSU1xuXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZFRpdGxlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG5cbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuXG4gIGNvbnN0IGNhcmRMaWtlQnRuRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjYXJkTGlrZUJ0bkVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY2FyZExpa2VCdG5FbC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICB9KTtcblxuICBjb25zdCBjYXJkRGVsZXRlQnRuRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XG4gIGNhcmREZWxldGVCdG5FbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNhcmRFbGVtZW50LnJlbW92ZSgpO1xuICB9KTtcblxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByZXZpZXdJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3SW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld0NhcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VPbkVzY2FwZSk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VPbkVzY2FwZSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckZvcm1TdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBhcGlcbiAgICAuZWRpdEF2YXRhckluZm8oeyBhdmF0YXI6IGVkaXRBdmF0YXJJbnB1dC52YWx1ZSB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlQXZhdGFyRWwuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBlZGl0QXZhdGFyRm9ybUVsLnJlc2V0KCk7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRBdmF0YXJNb2RhbCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGVkaXRBdmF0YXJTdWJtaXRCdG4sIGNvbmZpZyk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGFib3V0OiBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVBvc3RGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7XG4gICAgbmFtZTogbmV3UG9zdENhcHRpb25JbnB1dC52YWx1ZSxcbiAgICBsaW5rOiBuZXdQb3N0TGlua0lucHV0LnZhbHVlLFxuICB9O1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGlucHV0VmFsdWVzKTtcbiAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICBuZXdQb3N0Rm9ybUVsLnJlc2V0KCk7XG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbiAgZGlzYWJsZUJ1dHRvbihuZXdQb3N0U3VibWl0QnRuLCBjb25maWcpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU9uRXNjYXBlKGV2dCkge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG9wZW5lZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9pcy1vcGVuZWRcIik7XG4gICAgaWYgKG9wZW5lZE1vZGFsKSBjbG9zZU1vZGFsKG9wZW5lZE1vZGFsKTtcbiAgfVxufVxuXG5lZGl0QXZhdGFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBlZGl0QXZhdGFyRm9ybUVsLFxuICAgIFtlZGl0QXZhdGFySW5wdXRdLFxuICAgIGNvbmZpZ1xuICApO1xuICBvcGVuTW9kYWwoZWRpdEF2YXRhck1vZGFsKTtcbn0pO1xuXG5lZGl0QXZhdGFyQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xufSk7XG5cbmVkaXRBdmF0YXJGb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJGb3JtU3VibWl0KTtcblxucHJldmlld01vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudDtcbiAgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQ7XG4gIHJlc2V0VmFsaWRhdGlvbihcbiAgICBlZGl0UHJvZmlsZUZvcm1FbCxcbiAgICBbZWRpdFByb2ZpbGVOYW1lSW5wdXQsIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dF0sXG4gICAgY29uZmlnXG4gICk7XG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5lZGl0UHJvZmlsZUNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG59KTtcblxuZWRpdFByb2ZpbGVGb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XG5cbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgb3Blbk1vZGFsKG5ld1Bvc3RNb2RhbCk7XG59KTtcblxubmV3UG9zdENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0Rm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUG9zdEZvcm1TdWJtaXQpO1xuXG5jb25zdCBtb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xuXG5tb2RhbHMuZm9yRWFjaCgobW9kYWwpID0+IHtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC50YXJnZXQgPT09IG1vZGFsKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbi8vIElOSVRcblxuZW5hYmxlVmFsaWRhdGlvbihjb25maWcpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9oYW5kbGVTZXJ2ZXJSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSByZXR1cm4gcmVzLmpzb24oKTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UocmVzKSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKHJlcykpO1xuICB9XG5cbiAgZWRpdEF2YXRhckluZm8oeyBhdmF0YXIgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UocmVzKSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4gdGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UocmVzKSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbImNvbmZpZyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50Iiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJhZGQiLCJyZXNldFZhbGlkYXRpb24iLCJmb3JtRWwiLCJmb3JFYWNoIiwiaW5wdXQiLCJlZGl0QXZhdGFyQnRuIiwiZG9jdW1lbnQiLCJwcm9maWxlQXZhdGFyRWwiLCJwcm9maWxlTmFtZUVsIiwicHJvZmlsZURlc2NyaXB0aW9uRWwiLCJlZGl0UHJvZmlsZUJ0biIsIm5ld1Bvc3RCdG4iLCJlZGl0QXZhdGFyTW9kYWwiLCJlZGl0QXZhdGFyQ2xvc2VCdG4iLCJlZGl0QXZhdGFyRm9ybUVsIiwiZWRpdEF2YXRhcklucHV0IiwiZWRpdEF2YXRhclN1Ym1pdEJ0biIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0UHJvZmlsZUNsb3NlQnRuIiwiZWRpdFByb2ZpbGVGb3JtRWwiLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RDbG9zZUJ0biIsIm5ld1Bvc3RGb3JtRWwiLCJuZXdQb3N0TGlua0lucHV0IiwibmV3UG9zdENhcHRpb25JbnB1dCIsIm5ld1Bvc3RTdWJtaXRCdG4iLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3TW9kYWxDbG9zZUJ0biIsInByZXZpZXdJbWFnZUVsIiwicHJldmlld0NhcHRpb25FbCIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJjYXJkc0xpc3QiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfaGFuZGxlU2VydmVyUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0QXBwSW5mbyIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwiZWRpdEF2YXRhckluZm8iLCJhdmF0YXIiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsImF1dGhvcml6YXRpb24iLCJnZXRDYXJkRWxlbWVudCIsImRhdGEiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZUVsIiwiY2FyZEltYWdlRWwiLCJzcmMiLCJsaW5rIiwiYWx0IiwiY2FyZExpa2VCdG5FbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0b2dnbGUiLCJvcGVuTW9kYWwiLCJtb2RhbCIsImNsb3NlT25Fc2NhcGUiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleSIsIm9wZW5lZE1vZGFsIiwiY2FyZHMiLCJ1c2VyIiwiY2FyZCIsImFwcGVuZCIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwicHJldmVudERlZmF1bHQiLCJ2YWx1ZSIsInJlc2V0IiwicHJlcGVuZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ0YXJnZXQiLCJzZXRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiZnJvbSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlbmFibGVWYWxpZGF0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==